# TASK-024: Project Initialization Script

**Priority**: High  
**Estimated**: 4 hours  
**Dependencies**: TASK-001 (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )

## Prerequisites

- Node.js CLI é–‹ç™ºã®åŸºç¤
- AWS SDK ã®çŸ¥è­˜
- å¯¾è©±å¼ UI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆinquirerç­‰ï¼‰ã®ç†è§£

## Reference Implementation

- Primary: `@docs/impl/workflow/project-init.md` - åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè£…
- Security: `@docs/impl/security/best-practices.md` - Secrets Manager

## Acceptance Criteria

- [ ] `npm run init` ã§å¯¾è©±å¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒé–‹å§‹ã•ã‚Œã‚‹
- [ ] å¿…è¦ãª AWS ãƒªã‚½ãƒ¼ã‚¹ã®å­˜åœ¨ç¢ºèªãŒè¡Œã‚ã‚Œã‚‹ï¼ˆproject-init.md Section 3ï¼‰
- [ ] .env ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ï¼ˆSecrets Manager å„ªå…ˆï¼‰
- [ ] ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®é¸æŠãŒå¯èƒ½ï¼ˆéåŒæœŸã‚¸ãƒ§ãƒ–ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰
- [ ] åˆæœŸãƒ‡ãƒ—ãƒ­ã‚¤ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹
- [ ] ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ã¾ã§ 30 åˆ†ä»¥å†…
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½

## Detailed Implementation

### Main Script
```typescript
// scripts/init.ts - project-init.md Section 4
import { program } from 'commander';
import inquirer from 'inquirer';
import { SecretsManagerClient } from '@aws-sdk/client-secrets-manager';
import chalk from 'chalk';
import ora from 'ora';

interface InitOptions {
  projectName: string;
  awsProfile?: string;
  region: string;
  features: {
    asyncJobs: boolean;
    scheduledTasks: boolean;
    monitoring: boolean;
  };
}

class ProjectInitializer {
  private secrets: SecretsManagerClient;
  
  async run() {
    console.log(chalk.blue('ğŸš€ ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåˆæœŸåŒ–'));
    
    // 1. å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯
    await this.checkPrerequisites();
    
    // 2. å¯¾è©±å¼è¨­å®š
    const options = await this.promptConfiguration();
    
    // 3. AWS æ¥ç¶šç¢ºèª
    await this.verifyAWSAccess(options);
    
    // 4. ç’°å¢ƒè¨­å®šç”Ÿæˆ
    await this.generateEnvironment(options);
    
    // 5. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    await this.installDependencies();
    
    // 6. åˆæœŸãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
    await this.createInitialResources(options);
    
    // 7. ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
    if (await this.confirmSampleData()) {
      await this.seedSampleData();
    }
    
    console.log(chalk.green('âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼'));
  }
```

### Interactive Configuration
```typescript
  private async promptConfiguration(): Promise<InitOptions> {
    const answers = await inquirer.prompt([
      {
        type: 'input',
        name: 'projectName',
        message: 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå:',
        default: 'my-serverless-app',
        validate: (input) => /^[a-z0-9-]+$/.test(input),
      },
      {
        type: 'list',
        name: 'region',
        message: 'AWS ãƒªãƒ¼ã‚¸ãƒ§ãƒ³:',
        choices: ['ap-northeast-1', 'us-east-1', 'eu-west-1'],
        default: 'ap-northeast-1',
      },
      {
        type: 'checkbox',
        name: 'features',
        message: 'ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’é¸æŠ:',
        choices: [
          { name: 'éåŒæœŸã‚¸ãƒ§ãƒ–å‡¦ç†', value: 'asyncJobs' },
          { name: 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¿ã‚¹ã‚¯', value: 'scheduledTasks' },
          { name: 'ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', value: 'monitoring' },
        ],
      },
    ]);
    
    return this.parseAnswers(answers);
  }
```

### Environment Generation
```typescript
  private async generateEnvironment(options: InitOptions) {
    const spinner = ora('ç’°å¢ƒè¨­å®šã‚’ç”Ÿæˆä¸­...').start();
    
    try {
      // Secrets Manager å„ªå…ˆ
      const secrets = await this.fetchSecrets(options);
      
      const envContent = `
# Generated by init script
PROJECT_NAME=${options.projectName}
AWS_REGION=${options.region}
STAGE=dev

# Features
ENABLE_ASYNC_JOBS=${options.features.asyncJobs}
ENABLE_SCHEDULED_TASKS=${options.features.scheduledTasks}

# Secrets from AWS Secrets Manager
GOOGLE_CLIENT_ID=${secrets.googleClientId || 'SET_IN_SECRETS_MANAGER'}
GOOGLE_CLIENT_SECRET=${secrets.googleClientSecret || 'SET_IN_SECRETS_MANAGER'}
JWT_SECRET=${secrets.jwtSecret || this.generateJWTSecret()}
`;
      
      await fs.writeFile('.env', envContent);
      spinner.succeed('ç’°å¢ƒè¨­å®šã‚’ç”Ÿæˆã—ã¾ã—ãŸ');
    } catch (error) {
      spinner.fail('ç’°å¢ƒè¨­å®šã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
      throw error;
    }
  }
}
```

### Rollback Support
```typescript
private async rollback(error: Error) {
  console.error(chalk.red('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error.message));
  
  const { confirmRollback } = await inquirer.prompt([
    {
      type: 'confirm',
      name: 'confirmRollback',
      message: 'ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã‹ï¼Ÿ',
      default: true,
    },
  ]);
  
  if (confirmRollback) {
    // ä½œæˆã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤
    await this.cleanup();
  }
}
```

## Quality Gates

- Setup time: < 30 minutes
- Error handling: 100% coverage
- Rollback success rate: 100%
- User experience: Clear progress indicators

## Verification Steps

```bash
# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
npm run init

# ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
cat .env
cat .env.local

# AWS ãƒªã‚½ãƒ¼ã‚¹ã®ç¢ºèª
aws dynamodb list-tables
aws s3 ls

# æ©Ÿèƒ½ãƒ•ãƒ©ã‚°ã®ç¢ºèª
grep ENABLE_ASYNC_JOBS .env

# å†å®Ÿè¡Œæ™‚ã®å†ªç­‰æ€§ç¢ºèª
npm run init # æ—¢å­˜ãƒªã‚½ãƒ¼ã‚¹ã‚’æ¤œå‡ºã—ã¦ ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
```

## Output

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªåˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- 30åˆ†ä»¥å†…ã®å®Œå…¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- ã‚¨ãƒ©ãƒ¼æ™‚ã®å®‰å…¨ãªãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

## Progress

- [ ] Started
- [ ] Implementation complete
- [ ] Verified
- [ ] Documented