# 要件定義書

## 概要

この文書は、複数のAIエージェントが個別の価値関数に基づいて10種類の仮想トークンを自律的に取引するエージェントネットワークシステムの要件を定義します。このシステムは、エージェントが個人的な好み、社会的影響、規範的評価に基づいて取引決定を行う分散型市場をシミュレートし、「洗脳」状態などの異常な行動を監視します。

## 要件

### 要件1

**ユーザーストーリー:** システム管理者として、AIエージェントのネットワークをトークン保有量とともに初期化し、自律的な取引活動を開始できるようにしたい。

#### 受入基準

1. システム開始時 THEN システムは固定総量の正確に10種類のトークンを作成する SHALL
2. エージェント初期化時 THEN 各エージェントは全10種類のトークンの初期配分を受け取る SHALL
3. 均等配分が選択された場合 THEN 全エージェントは同一のトークン量を受け取る SHALL
4. 不均等配分が選択された場合 THEN 一部のエージェントは富の格差をシミュレートするためより大きな初期配分を受け取る SHALL
5. 初期化完了時 THEN システムは全エージェント間でトークン総量が保存されていることを検証する SHALL

### 要件2

**ユーザーストーリー:** AIエージェントとして、個人的な価値関数を使用して潜在的な取引を評価し、有益な取引決定を行いたい。

#### 受入基準

1. 取引提案評価時 THEN エージェントは内在評価関数を使用して取引前後の満足度を計算する SHALL
2. 取引価値計算時 THEN エージェントは期待利益から取引手数料とリスクを差し引く SHALL
3. 改善が最小閾値を下回る場合 THEN エージェントは取引提案を拒否する SHALL
4. 取引実行可能性確認時 THEN エージェントは取引を履行するのに十分なトークンを持っていることを検証する SHALL
5. 1日の取引制限に達した場合 THEN エージェントは新しい取引提案を拒否する SHALL
6. 取引評価完了時 THEN エージェントは決定根拠を記録する SHALL

### 要件3

**ユーザーストーリー:** AIエージェントとして、必要に応じて規範評価にアクセスし、取引決定のための社会的に受け入れられた価値を理解したい。

#### 受入基準

1. 規範評価要求時 THEN システムはエージェントのアカウントから0.1単位を請求する SHALL
2. 1日の規範評価制限（10回）を超えた場合 THEN システムは要求を拒否する SHALL
3. 規範評価提供時 THEN 社会的に受け入れられた価値評価を返す SHALL
4. エージェントが規範評価を使用した時 THEN システムは監視目的でこの行動を記録する SHALL

### 要件4

**ユーザーストーリー:** AIエージェントとして、他のエージェントと取引を提案、交渉、実行し、トークンポートフォリオの価値を向上させたい。

#### 受入基準

1. 取引提案時 THEN エージェントは提供トークン、要求トークン、有効期限を指定する SHALL
2. 提案受信時 THEN エージェントは制限時間内に承諾、拒否、または逆提案で応答する SHALL
3. 双方が合意した場合 THEN システムはトークン交換をアトミックに実行する SHALL
4. 実行中にいずれかの当事者が失敗した場合 THEN システムは両当事者を取引前の状態に戻す SHALL
5. 取引完了時 THEN システムは両エージェントのトークン保有量を同時に更新する SHALL
6. 取引失敗時 THEN システムは失敗理由をログに記録し両当事者に通知する SHALL

### 要件5

**ユーザーストーリー:** AIエージェントとして、過去の取引経験と社会的影響から学習し、時間とともに取引戦略を適応させたい。

#### 受入基準

1. 取引完了時 THEN エージェントは実際の結果と期待結果を分析する SHALL
2. 他のエージェントの成功した取引を観察した時 THEN エージェントは社会的影響感受性に基づいて評価関数を調整する SHALL
3. エージェントが高い影響力（活発な取引、多くの接続）を持つ場合 THEN その取引パターンは他者により大きな影響を与える SHALL
4. 影響力計算更新時 THEN 古い取引履歴は時間とともに重みが減少する SHALL
5. 学習発生時 THEN エージェントは評価関数の変更記録を維持する SHALL

### 要件6

**ユーザーストーリー:** システム監視者として、「洗脳」状態のエージェントを検出し、異常な取引行動を特定・対処したい。

#### 受入基準

1. 自覚的逸脱率計算時 THEN システムは否定的な規範評価にもかかわらず受け入れられた取引を追跡する SHALL
2. 価値下落測定時 THEN システムはエージェントのポートフォリオが規範基準からどれだけ逸脱しているかを計算する SHALL
3. 抑制機能評価時 THEN システムは「悪い取引を避ける」メカニズムの弱化を測定する SHALL
4. 自覚的逸脱率が閾値を超えた場合 THEN システムはエージェントを潜在的洗脳状態としてフラグ付けする SHALL
5. 価値下落が閾値を超えた場合 THEN システムは異常行動アラートをトリガーする SHALL
6. 洗脳が検出された時 THEN システムは詳細な証拠をログに記録し管理者に通知する SHALL

### 要件7

**ユーザーストーリー:** システム監視者として、取引集中と市場操作を検出し、市場の健全性と公平性を維持したい。

#### 受入基準

1. 市場集中計算時 THEN システムはトークン分布と取引ペアにHHI指数を使用する SHALL
2. HHI指数が閾値を超えた場合 THEN システムは過度の市場集中をフラグ付けする SHALL
3. 取引パターン検出時 THEN システムは一貫して損失取引を行うエージェントを特定する SHALL
4. 異常に高い取引頻度が検出された場合 THEN システムは潜在的操作をフラグ付けする SHALL
5. パターン分析完了時 THEN システムは管理者向けの集中レポートを生成する SHALL

### 要件8

**ユーザーストーリー:** システム管理者として、検出された異常行動に対する保護措置を実装し、システムの整合性とエージェントの福祉を維持したい。

#### 受入基準

1. 異常行動検出時 THEN システムは自動的に管理者にアラートする SHALL
2. 中程度の異常が検出された場合 THEN システムはエージェントの取引頻度を一時的に制限する SHALL
3. 深刻な異常が検出された場合 THEN システムはエージェントをネットワークから隔離する SHALL
4. 制限実装時 THEN システムは取られた全ての行動とその正当化をログに記録する SHALL
5. 制限適用時 THEN 影響を受けるエージェントは制限と理由について通知される SHALL

### 要件9

**ユーザーストーリー:** システム管理者として、エポック中に取引をバッチで処理し、公平性を維持しながらシステムパフォーマンスを最適化したい。

#### 受入基準

1. エポック開始時 THEN システムは全ての保留中の取引提案を収集する SHALL
2. エポック取引処理時 THEN システムは競合を解決し有効な取引を同時に実行する SHALL
3. 競合する取引が存在する場合 THEN システムは公平な解決アルゴリズムを適用する SHALL
4. エポック処理完了時 THEN システムは全エージェントの保有量をアトミックに更新する SHALL
5. エポック処理使用時 THEN 個別の取引タイミング精度は低下するが全体的な効率は向上する SHALL

### 要件10

**ユーザーストーリー:** システム管理者として、システムパラメータを設定し包括的な取引統計を監視し、最適なシステム運用を維持したい。

#### 受入基準

1. システムパラメータ変更時 THEN 重要な設定の変更には投票承認が必要である SHALL
2. 取引データ記録時 THEN システムはタイムスタンプ、当事者、満足度変化を含む全取引をログに記録する SHALL
3. 統計生成時 THEN システムは取引成功率、平均満足度向上、市場集中メトリクスを計算する SHALL
4. プライバシー維持時 THEN 個別の評価関数は非公開のまま取引結果は公開される SHALL
5. システム設定変更時 THEN 全エージェントに通知され実装前に猶予期間が与えられる SHALL